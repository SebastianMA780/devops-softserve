{% extends "base.html" %}

{% block title %}Articles - Home{% endblock %}

{% block content %}
{% if articles %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for article in articles %}
    <div class="bg-white shadow-lg rounded-lg p-5">
        <h2 class="text-xl font-semibold text-gray-800 mb-2">{{ article.title }}</h2>
        <p class="text-sm text-gray-500 mb-3">Created on {{ article.created_at.strftime('%d of %B') }}{% if session['user_id'] %} by {{ article.author.username }}{% endif %}</p>
        <p class="text-gray-700 mb-4">
            {% if session['user_id'] %}
                {{ article.content[:140] }}{% if article.content|length > 140 %}...{% endif %}
            {% else %}
                {{ article.content[:70] }}{% if article.content|length > 70 %}... <a href="{{ url_for('auth.login') }}" class="text-blue-500 hover:underline">Login to read more</a>{% endif %}
            {% endif %}
        </p>

        {% if article.categories %}
        <div class="mb-3">
            <span class="text-sm font-semibold text-gray-600">Categories:</span>
            {% for category in article.categories %}
            <span class="ml-1 inline-block bg-gray-200 rounded-full px-2 py-0.5 text-xs font-semibold text-gray-700">{{ category.name }}</span>
            {% endfor %}
        </div>
        {% endif %}

        {% if session['user_id'] and session['user_id'] == article.author.id %}
        <div class="flex justify-end space-x-2">
            <a href="{{ url_for('articles.edit_article', id=article.id) }}"
                class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600" title="Edit Article">Edit</a>
            <form method="POST" action="{{ url_for('articles.delete_article', id=article.id) }}"
                onsubmit="return confirm('Are you sure you want to delete this article?');">
                <button type="submit" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"
                    title="Delete Article">Delete</button>
            </form>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<p class="text-gray-500">No articles available. Start by creating one!</p>
{% endif %}

{% endblock %}